<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout}">
<head>
    <title>Mis Proyectos (Gestor)</title>
</head>
<body>
<section layout:fragment="content">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 mb-0">Mis Proyectos</h1>
        <a th:href="@{/projects/new}" class="btn btn-primary">
            <i class="bi bi-plus-circle me-1"></i> Crear Nuevo Proyecto
        </a>
    </div>

    <div class="alert alert-info text-center fst-italic" th:if="${#lists.isEmpty(projects)}">
        <i class="bi bi-info-circle me-2"></i> No tienes proyectos creados. ¡Anímate a crear el primero!
    </div>

    <!-- Display projects as cards -->
    <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" th:if="${!#lists.isEmpty(projects)}">
        <div class="col d-flex align-items-stretch" th:each="project : ${projects}">
            <div class="card h-100 shadow-sm" th:classappend="${project.closed ? 'border-secondary bg-light' : 'border-primary'}">
                <div class="card-body d-flex flex-column pb-0"> <!-- Remove bottom padding -->
                    <h5 class="card-title mb-2" th:text="${project.title}">Título del Proyecto</h5>
                    <p class="card-text small text-muted flex-grow-1" th:text="${#strings.abbreviate(project.description, 120) ?: 'Sin descripción.'}">
                        Descripción corta...
                    </p>
                </div>
                <ul class="list-group list-group-flush small">
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Estado:
                        <span th:text="${project.closed ? 'Cerrado' : 'Activo'}"
                              th:classappend="${project.closed ? 'badge bg-secondary' : 'badge bg-success'}"></span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Creado:
                        <span class="text-muted" th:text="${#temporals.format(project.createdAt, 'dd/MM/yyyy')}"></span>
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Tareas:
                        <span class="badge bg-primary rounded-pill" th:text="${project.tasks != null ? #lists.size(project.tasks) : 0}">0</span> <!-- Need tasks loaded for count -->
                    </li>
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        Colaboradores:
                        <span class="badge bg-info text-dark rounded-pill" th:text="${project.collaborators != null ? #lists.size(project.collaborators) : 0}">0</span> <!-- Need collaborators loaded -->
                    </li>
                </ul>
                <div class="card-footer bg-light text-end"> <!-- Light footer, right aligned buttons -->
                    <a th:href="@{'/projects/' + ${project.id}}" class="btn btn-sm btn-outline-primary me-1" title="Ver Detalles">
                        <i class="bi bi-eye"></i> Detalles
                    </a>
                    <a th:href="@{'/projects/' + ${project.id} + '/edit'}" class="btn btn-sm btn-outline-secondary"
                       title="Editar Proyecto" th:if="${!project.closed}">
                        <i class="bi bi-pencil"></i> Editar
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>
</body>
</html>